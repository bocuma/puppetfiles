#!/bin/sh

# Author: Jon Kinney
# Based on the opensuse skeleton /etc/init.d/skeleton init script

NAME=god
DESC=god

set -e

RVM_PATH= "<%= @rvm_path %>"
RUBY_VERSION="<%= @ruby_version %>"
PID_FILE="/var/run/god.pid"
LOG_FILE="/var/log/god.log"
CONFIG_FILE="/etc/god/god.conf"
COMMAND="/${RVM_PATH}/wrappers/${RUBY_VERSION}/god"

CMD="${COMMAND} -c ${CONFIG_FILE}  -P ${PID_FILE} -l ${LOG_FILE} --log-level debug"


RETVAL=0

case "$1" in
  start)
    echo -n "Starting $DESC: "
    $CMD
    RETVAL=$?
    echo "$NAME."
    ;;
  stop)
    echo -n "Stopping $DESC: "
    kill `cat ${PID_FILE}`
    RETVAL=$?
    echo "$NAME."
    ;;
  restart)
    echo -n "Restarting $DESC: "
    kill `cat ${PID_FILE}`
    $CMD
    RETVAL=$?
    echo "$NAME."
    ;;
  status)
    $CMD status
    RETVAL=$?
    ;;
  *)
    echo "Usage: god {start|stop|restart|status}"
    exit 1
    ;;
esac

exit $RETVAL
